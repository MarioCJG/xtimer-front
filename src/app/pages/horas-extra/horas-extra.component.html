<div class="container-fluid px-4 mt-5">
  <div class="modo-switch d-flex align-items-center gap-2 mb-4 justify-content-end">
    <span class="icon" [class.active]="!darkModeService.modoOscuro">ðŸŒž</span>
    <label class="switch">
      <input type="checkbox" [checked]="darkModeService.modoOscuro" (change)="darkModeService.toggleModo()" />
      <span class="slider round"></span>
    </label>
    <span class="icon" [class.active]="darkModeService.modoOscuro">ðŸŒ™</span>
  </div>

  <h2 class="seccion-titulo">Registrar Horas</h2>

  <!-- Selector de Mes -->
  <div class="d-flex gap-2 mb-3">
    <button class="btn" [ngClass]="{
        'btn-primary': mesSeleccionado === mesAnterior,
        'btn-light': mesSeleccionado !== mesAnterior
      }" (click)="seleccionarMesAnterior()">
      {{ mesAnterior }}
    </button>
    <button class="btn" [ngClass]="{
        'btn-primary': mesSeleccionado === mesActual,
        'btn-light': mesSeleccionado !== mesActual
      }" (click)="seleccionarMesActual()">
      {{ mesActual }}
    </button>
  </div>

  <!-- Calendario + semanas + dÃ­as -->
  <div class="mb-5">
    <h4 class="text-center seccion-titulo">ðŸ“† Calendario del Mes</h4>
    <div *ngIf="fechaSeleccionada">
      <h5>ðŸ“… Fecha seleccionada: {{ fechaSeleccionada }}</h5>
    </div>

    <div class="d-flex justify-content-center gap-4 align-items-center flex-wrap">
      <!-- Columna izquierda: Semanas + DÃ­as -->
      <div class="d-flex flex-column gap-4">
        <!-- Botones de semanas -->
        <div class="d-flex flex-column gap-2">
          <h5>Semanas del mes:</h5>
          <button *ngFor="let semana of semanas; let i = index" class="btn btn-sm" [ngClass]="{
              'btn-primary': semanaSeleccionada === i,
              'btn-light': semanaSeleccionada !== i
            }" (click)="mostrarDiasSemana(i)">
            Semana {{ i + 1 }}
          </button>
        </div>

        <!-- Botones de dÃ­as -->
        <div class="d-flex flex-column gap-2">
          <h5>dias :</h5>
          <button *ngFor="let dia of getDiasFiltrados()" class="btn btn-sm text-start" [ngClass]="{
              'btn-primary': diaSeleccionado === dia.dia,
              'btn-light': diaSeleccionado !== dia.dia
              }" (click)="seleccionarDia(dia)">
            {{ dia.nombre }} {{ dia.dia }}
          </button>
        </div>
      </div>

      <!-- Calendario -->
      <div class="fc-mini">
        <full-calendar #fullCalendar [options]="calendarOptions" (dateClick)="onCalendarDateClick($event)">
        </full-calendar>
      </div>
    </div>
  </div>

  <!-- Cliente -->
  <div class="mb-4">
    <label class="form-label">Seleccionar Cliente:</label>
    <select class="form-select" [(ngModel)]="clienteSeleccionado" (change)="filtrarProyectosPorCliente()">
      <option value="">Todos los Clientes</option>
      <option *ngFor="let cliente of clientes" [value]="cliente.nombre_cliente">
        {{ cliente.nombre_cliente }}
      </option>
    </select>
  </div>


  <!-- ðŸ“Š Nueva Tabla de Horas -->
  <div *ngIf="fechaSeleccionada" class="mb-5">
    <h4 class="mb-3">ðŸ•’ Registro Diario de Horas</h4>
    <div class="table-responsive">
      <table class="table table-bordered text-center align-middle horas-table">
        <thead class="table-light">
          <tr>
            <th class="proyecto-col">Proyecto</th>
            <th *ngFor="let hora of horasAgrupadas" colspan="2" class="hora-col">
              {{ hora }}
            </th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let proyecto of proyectosFiltrados; let rowIndex = index">
            <td 
              class="proyecto-cell" 
              [ngClass]="{ 'comentario-presente': proyecto.tieneComentario }" 
              (click)="seleccionarProyecto(proyecto)">
              {{ proyecto.nombre_proyecto }}
              <span *ngIf="proyecto.tieneComentario" class="comentario-icon">ðŸ’¬</span>
            </td>
            <td *ngFor="let cell of copiaGrid[rowIndex]; let colIndex = index" class="hora-cell" [ngClass]="{
                  selected:
                    cell.selected &&
                    !(colIndex === 0 || colIndex === 1 || colIndex >= 20),
                  'highlight-yellow':
                    cell.selected &&
                    (colIndex === 0 || colIndex === 1 || colIndex >= 20)
                }" (mousedown)="onMouseDown($event, rowIndex, colIndex)" (mouseover)="onMouseOver(rowIndex, colIndex)"
              (mouseup)="onMouseUp()">
              <small class="hora-mini">{{ calcularHorario(colIndex) }}</small>
            </td>
          </tr>
        </tbody>
      </table>
      <!-- ðŸ§® Resumen del DÃ­a -->
      <div class="mb-3">
        <h5>ðŸ•’ Total Horas del DÃ­a: {{ calcularTotalHorasDelDia().total }}</h5>
        <h5 *ngIf="calcularTotalHorasDelDia().extras !== '00:00'">
          ðŸ”¥ Horas extra: {{ calcularTotalHorasDelDia().extras }}
        </h5>
      </div>

      <div class="text-end mb-5">
        <button class="btn btn-success" (click)="guardar()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Horas Registradas -->
  <!-- <h3 class="mb-4">ðŸ“‹ Horas Registradas</h3>

  <div class="row mb-3">
    <div class="col">
      <label>Desde:</label>
      <input
        type="date"
        class="form-control"
        [(ngModel)]="fechaDesde"
        (change)="onFechaDesdeChange()"
      />
    </div>
    <div class="col">
      <label>Hasta:</label>
      <input
        type="date"
        class="form-control"
        [(ngModel)]="fechaHasta"
        (change)="onFechaHastaChange()"
      />
    </div>
    <div class="col">
      <label>Estado:</label>
      <select [(ngModel)]="filtroEstado" class="form-control">
        <option value="">Todos los estados</option>
        <option value="pendiente">Pendiente</option>
        <option value="aprobado">Aprobado</option>
        <option value="rechazado">Rechazado</option>
      </select>
    </div>
  </div>

  <table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Fecha</th>
        <th>Usuario</th>
        <th>Proyecto</th>
        <th>Hora Inicio</th>
        <th>Hora Fin</th>
        <th>Total Horas</th>
        <th>DescripciÃ³n</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="
          let hora of horasExtraFiltradas
            | filterFecha : filtroFecha
            | filterEstado : filtroEstado
        "
      >
        <td>{{ hora.fecha | date : "yy-MM-dd" }}</td>
        <td>{{ hora.usuario_completo }}</td>
        <td>{{ hora.proyecto_completo }}</td>
        <td>{{ hora.hora_inicio }}</td>
        <td>{{ hora.hora_fin }}</td>
        <td>{{ hora.total_horas }}</td>
        <td>{{ hora.descripcion }}</td>
        <td>
          <span
            [ngClass]="{
              'badge bg-warning': hora.estado === 'pendiente',
              'badge bg-success': hora.estado === 'aprobado',
              'badge bg-danger': hora.estado === 'rechazado'
            }"
          >
            {{ hora.estado }}
          </span>
        </td>
        <td>
          <button
            class="btn btn-sm btn-primary"
            (click)="editarHoraExtra(hora)"
          >
            Editar
          </button>
          <button
            class="btn btn-sm btn-danger"
            (click)="eliminarHoraExtra(hora.id)"
          >
            Eliminar
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="d-flex justify-content-end gap-2 mt-3">
    <button class="btn btn-success" (click)="exportarExcel()">
      ðŸ“Š Exportar Excel
    </button>
    <button class="btn btn-danger" (click)="exportarPDF()">
      ðŸ“„ Exportar PDF
    </button>
  </div> -->
</div>